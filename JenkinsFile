pipeline {
   agent any

   stages {
      stage('Hello') {
         steps {
            echo 'Hello Pipeline World'
         }
      }
       stage('Unit & Integration Tests') {
                  steps {
                      script {
                          try {
                              sh './gradlew test' //run a gradle task
                          } finally {
                              echo 'script failed'
                          }
                      }
                      step([$class: 'Publisher', reportFilenamePattern: '**/testng-results', unstableSkips: 50])
                  }
       }
   }

   post {
        always {
            cleanWs()
        }
   }

}